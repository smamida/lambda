import boto3
import json

def lambda_handler(event, context):
    
    client = boto3.client('secretsmanager', region_name='ap-south-1')
    
    service_name = "hanu_sn"
   

    try:
      
     
        print(f'Secret created: {response}')

        
        policy = {
            "Version": "2012-10-17",
            "Statement": [
                {
                    "Effect": "Deny",
                    "Principal": "*",
                    "Action": "secretsmanager:GetSecretValue",
                    "Resource": f"arn:aws:secretsmanager:ap-south-1:account_id:secret:{service_name}",
                    "Condition": {
                        "StringNotEquals": {
                            "aws:PrincipalArn": [
                                "arn:aws:iam::account_id:role/service-role/AWSGlueServiceRole-hanuglue",
                                "arn:aws:iam::account_id:role/aws-service-role/redshift.amazonaws.com/AWSServiceRoleForRedshift",
                                "arn:aws:iam::account_id:role/role3",
                                "arn:aws:iam::account_id:role/role4"
                            ]
                        }
                    }
                }
            ]
        }

        
        response = client.put_resource_policy(
            SecretId=service_name,
            ResourcePolicy=json.dumps(policy)
        )
        print(f'Policy attached: {response}')
        
    except Exception as e:
        print(f'Error: {e}')
